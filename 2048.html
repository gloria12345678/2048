<!doctype html>
<html>
<head></head>
<style type="text/css">
*{
    font-family: arial;
    margin: 0;
    padding: 0;
}
.header{
    width: 500px;
    height: 50px;
    color: #000;
    margin: 0 auto;
    font-size: 48px;
    font-weight: bold;
    margin-top: 100px;
}
.header>span{
    color: #fb7f7f;
}
.cell_all{
    width: 570px;
    height: 570px;
    margin: 0 auto;
    background-color: #fbe3d2;
    border-radius: 10px;
    margin-top: 60px;
    padding: 35px;
}
.cell{
    width: 110px;
    height: 110px;
    border: 8px solid #536e90;
    opacity: 0.95;
    float: left;
    border-radius: 50px;
    margin-left: 13px;
    margin-top: 13px;
    font-size: 35px;
    font-weight: bold;
    line-height: 110px;
    text-align: center;
    color: #fff;
}
/*不同数字加减后的数值*/
.n2{
    background-color:#b0e0fd;
    color:#ffffff;
}
.n4{
    background-color:#ff5050;
    color:#69658a;
}
.n8{
    background-color:#f2b179;
}
.n16{
    background-color:#f59563;
}
.n32{
    background-color:#f67c5f;
}
.n64{
    background-color:#f65e3b;
}
.n128{
    background-color:#edcf72;
}
.n256{
    background-color:#edcc61;
}
.n512{
    background-color:#9c0;
}
.n1024{
    font-size:40px;
    background-color:#33b5e5;
}
.n2048{
    font-size:40px
    background-color:#a9c;
}
.n4096{
    background-color:#a6c;
    font-size:40px;
}
.n8192{
    background-color:#93c;
    font-size:40px;
}

/*gameover*/
.gameover{
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0,0,0,0.3);
    display: none;
}
.gameover>p{
    width: 300px;
    height: 200px;
    background-color: #fff;
    border: 1px solid #000;
    border-radius: 15px;
    position: absolute;
    left: 50%;
    top: 50%;
    margin-top: -100px;
    margin-left: -150px;

    font-size: 30px;
    font-weight: bold;
    text-align: center;
    line-height: 66px;
}

.gameover_p{
    width: 200px;
    height: 200px;
    margin: auto 0px;
}
.gameover_p>span{
    color: #f00;
    font-size: 40px;
   
}

.gameover_p>a{
    text-decoration: none;
    background-color: #f58827;
    border-radius: 5px;
    color: #fff;
    padding: 8px 8px 4px;
}

</style>
<body>
    
        
            <!-- 4*4 -->
            <div class="cell_all">
                <!-- 第一行 -->
                <div class="cell" id="c00"></div>
                <div class="cell" id="c01"></div>
                <div class="cell" id="c02"></div>
                <div class="cell" id="c03"></div>
                <!-- 第二行 -->
                <div class="cell" id="c10"></div>
                <div class="cell" id="c11"></div>
                <div class="cell" id="c12"></div>
                <div class="cell" id="c13"></div>
                <!-- 第三行 -->
                <div class="cell" id="c20"></div>
                <div class="cell" id="c21"></div>
                <div class="cell" id="c22"></div>
                <div class="cell" id="c23"></div>
                <!-- 第四行 -->
                <div class="cell" id="c30"></div>
                <div class="cell" id="c31"></div>
                <div class="cell" id="c32"></div>
                <div class="cell" id="c33"></div>
                <!--[
                        [00,01,02,03],
                        [10,11,12,13],
                        [20,21,22,23],
                        [30,31,32,33]
                ]-->
            </div>
        
            <!-- gameover -->
            <div class="gameover_p" id="gameover">
                <p class="gameover_p">
                    GAMEOVER！<br>
                    <a href="javascript:game.start()">TRY AGAIN!</a>
                </p>
            </div>
        
       
</body>
<script>
var game = {
    data:[],
    start: function(){
        game.data = [
                [0,0,0,0],
                [0,0,0,0],
                [0,0,0,0],
                [0,0,0,0]
        ]
        game.randomNum();
        game.randomNum();
        game.dataView();
    },
    randomNum:function(){
        for(;;){
            var r = Math.floor(Math.random()*4);//生成一个行
            var c = Math.floor(Math.random()*4);//生成一个列
            if(game.data[r][c] == 0){//只有数组这一个位置为 0 的时候才可以赋值
                var num = Math.random()>0.5?2:4; //随机生成2或者4
                game.data[r][c] = num;
                break;//退出死循环
            }
        }
    },
    dataView:function(){    
        for (var r = 0; r < 4; r++) {
            for(var c = 0; c<4;c++){
               
                var div = document.getElementById("c" + r + c); 
                if(game.data[r][c] != 0){   
                    div.innerHTML = game.data[r][c];
                    div.className = "cell n" + game.data[r][c]; 
                }else{  
                    div.innerHTML = "";
                    div.className = "cell";
                }
            }
        }
    },
    isgameover:function(){  
       
        for(var r = 0;r<4;r++){
            for(var c = 0;c<4;c++){
                if(game.data[r][c] == 0){ 
                    return false;
                }
                if(c<3){
                    if(game.data[r][c] == game.data[r][c+1]){
                        return false;
                    }
                }
                if(r<3){
                    if(game.data[r][c] == game.data[r+1][c]){
                        return false;
                    }
                }

            }
        }
        return true;
    },





    //移动的方法：
    //左移
    moveLeft:function(){
        var before = String(game.data);
        for(var r = 0;r<4;r++){
            game.moveLeftinRow(r);
        }
        var after = String(game.data);
        
        if(before != after){    
            game.randomNum();   
            if(game.isgameover()){
                game.gamerunning == game.gameover;      
            }
            game.dataView();
        }
    },
    moveLeftinRow:function(r){
        for(var c = 0;c<3;c++){
            var nextc = game.moveLeftNextRows(r,c);
            if(nextc != -1){
                if(game.data[r][c] == 0){
                    game.data[r][c] = game.data[r][nextc];
                    game.data[r][nextc] = 0;
                    c--;
                }else if(game.data[r][c] == game.data[r][nextc]){
                    game.data[r][c] *= 2;
                    game.score += game.data[r][c];
                    game.data[r][nextc] = 0;
                }
            }else{
                break;
            }
        }
    },
    moveLeftNextRows:function(r,c){
        for (var i = c+1;i<4;i++) {
            if (game.data[r][i] != 0) {
                return i;
            }
        }
        return -1;//如果没有找到，随意取一个标识符返回回来:表示没有找到
    },
    
    moveRight:function(){
        var before = String(game.data);
        for (var r = 0;r<4;r++) {
            game.moveRightinRow(r);
        }
        var after = String(game.data);
        if (before != after) {
            game.randomNum();
            if(game.isgameover()){
                game.gamerunning = game.gameover;
            }
            game.dataView();
        }
    },
    moveRightinRow:function(r){
        for(var c = 3;c>0;c--){
            var nextc = game.moveRightNextRows(r,c);
            if (nextc != -1) {
                if(game.data[r][c] == 0){
                    game.data[r][c] = game.data[r][nextc];
                    game.data[r][nextc] = 0;
                    c++;
                }else if (game.data[r][c] == game.data[r][nextc]) {
                    game.data[r][c] *= 2;
                    game.score += game.data[r][c];
                    game.data[r][nextc] = 0;
                }
            }else{
                break;
            }
        }
    },
    moveRightNextRows:function(r,c){
        for(var i = c-1;i>=0;i--){
            if (game.data[r][i] != 0) {
                return i;
            }
        }
        return -1;
    },
    moveTop:function(){
        var before = String(game.data);

        for(var c = 0;c<4;c++){
            game.moveTopinRow(c);
        }
        var after = String(game.data);

        if(before != after){
            game.randomNum();
            if(game.isgameover()){
                game.gamerunning = game.gameover;
            }
            game.dataView();
        }

    },
    moveTopinRow:function(c){
        for(var r = 0;r<4;r++){
            var nextr = game.moveTopNextRows(r,c);
            if(nextr != -1){
                if(game.data[r][c] == 0){
                    game.data[r][c] = game.data[nextr][c];//
                    game.data[nextr][c] = 0;
                    r--;
                }else if(game.data[r][c] == game.data[nextr][c]){
                    game.data[r][c] *= 2;
                    game.score += game.data[r][c];
                    game.data[nextr][c] = 0;
                }
            }else{
                break;
            }
        }
    },
    moveTopNextRows:function(r,c){
        for(var i = r + 1;i < 4;i++){
            
            if (game.data[i][c] != 0) {
                return i;
            }
        }
        return -1
    },
    
    moveDown:function(){
        var before = String(game.data);
        for(var c = 0;c<4;c++){
            game.moveDowninRow(c);
        }
        var after = String(game.data);
        if(before != after){
            game.randomNum();
            if(game.isgameover()){
                game.gamerunning = game.gameover;
            }
            game.dataView();
        }

    },
    moveDowninRow:function(c){
        for(var r = 3;r>=0;r--){
            var nextr = game.moveDownNextRows(r,c);
            if(nextr != -1){
                if(game.data[r][c] == 0){
                    game.data[r][c] = game.data[nextr][c];//
                    game.data[nextr][c] = 0;
                    r++;
                }else if(game.data[r][c] == game.data[nextr][c]){
                    game.data[r][c] *= 2;
                    game.score += game.data[r][c];
                    game.data[nextr][c] = 0;
                }
            }else{
                break;
            }
        }
    },
    moveDownNextRows:function(r,c){ 
        for(var i = r - 1;i >= 0;i--){
            
            if (game.data[i][c] != 0) {
                return i;
            }
        }
        return -1
    }
}

     game.start();
    document.onkeydown = function(e){
        var e = e || event || arguments[0];
        if(e.keyCode == 37){
            game.moveLeft();
        }else if (e.keyCode == 39) {
            game.moveRight();
        }else if (e.keyCode == 38) {
            game.moveTop();
        }else if (e.keyCode == 40) {
            game.moveDown();
        }
    }
</script>
</html>